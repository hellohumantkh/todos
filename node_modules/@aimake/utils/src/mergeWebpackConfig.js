const merge = require('webpack-merge');

module.exports = (clientConfig, defaultConfig) => {
  const config = merge({}, defaultConfig, clientConfig);
  /**
   * unique the rules
   * there we let client rules cover our rules
   * this way is hack
   */
  const rules = config.module.rules;
  const newRules = [];
  for (let i = 0; i < rules.length; i += 1) {
    const rule1 = rules[i];
    let flag = false;
    for (let j = i + 1; j < rules.length; j += 1) {
      const rule2 = rules[j];
      if (rule1.test + '' === rule2.test + '') {
        flag = true;
        break;
      }
    }
    if (!flag) {
      newRules.push(rule1);
    }
  }
  config.module.rules = newRules;
  return config;
};
